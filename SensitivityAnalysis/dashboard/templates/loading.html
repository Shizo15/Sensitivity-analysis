<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Analyzing...</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: #f9fafb; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: sans-serif; }
  .box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 500px; }
</style>
</head>
<body>
<div class="box">
  <h3 id="step-text" class="mb-4">Preparing...</h3>
  <div class="progress mb-3" style="height: 25px;">
    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-primary" role="progressbar" style="width: 0%;">0%</div>
  </div>
  <p class="text-muted small">Analysis may take a few minutes. Please do not close the window.</p>
</div>
<script>
  function pollStatus() {
    fetch("{% url 'get_analysis_status' %}")
      .then(res => res.json())
      .then(data => {
        document.getElementById('progress-bar').style.width = data.progress + "%";
        document.getElementById('progress-bar').innerText = data.progress + "%";
        document.getElementById('step-text').innerText = data.step;
        if (data.progress < 100) setTimeout(pollStatus, 500);
      });
  }
  fetch("{% url 'run_analysis' %}")
    .then(res => res.json())
    .then(data => { 
      if (data.status === "done") window.location.href = "{% url 'results_dashboard' %}"; 
    });
  pollStatus();
</script>
</body>
</html>